---
title: IP地址和子网划分学习笔记
date: 2017-01-15 16:09:32
tags: [ip,子网划分]
categories: 网络
---

## 一、IP地址和MAC地址
### 1.MAC地址
MAC地址，也叫物理地址，硬件地址。用来定义网络设备的位置，是固定的，一般出厂的时候就由厂商设置完成。MAC地址采用十六进制表示，长度是6个字节(48位)，分为前24位和后24位。
> 1.前24位叫做组织唯一标志符，是由IEEE的注册管理机构给不同厂家分配的代码，区分了不同的厂家。
> 2.后24位是由厂家自己分配的，称为扩展标识符。同一个厂家生产的网卡中MAC地址后24位是不同的。

MAC地址对于OSI七层模型来说是位于第二层数据链路层，工作在数据链路层的交换机维护着计算机的MAC地址和端口的数据库，交换机根据收到的数据帧中的“目标MAC地址”来转发数据帧。
### 2.IP地址
IP地址为互联网上每一个网络和每一台主机分配一个逻辑地址，常见的IP地址分为IPv4和IPv6两类，目前应用最广泛的是IPv4，不过几乎耗尽，下一阶段必定会升级为IPv6。
![](/img/IP地址和子网划分学习笔记/IP地址版本.png 'IP地址版本')
IP地址对于OSI七层模型来说是位于第三层网络层，工作在网络层的路由器通过判断目标IP和源IP是否属于同一网段，如果不是同一网段，则转发数据包。
### 3.IP地址组成
IP地址=网络地址+主机地址，比如：
![](/img/IP地址和子网划分学习笔记/IP地址构成.png 'IP地址构成')
计算机的IP地址由两部分组成，一部分为网络标识，一部分为主机标识，同一网段内的计算机网络部分相同，主机部分不同。路由器连接不同网段，负责不同网段之间的数据转发，交换机连接的是同一网段的计算机。
### 4.IP地址和MAC地址的作用与关系
在数据通信时，IP地址专注与网络层，网络层设备(路由器)根据IP地址，将数据包从一个网络传递到另一个网络上。而MAC地址专注于数据链路层，链路层设备(交换机)将数据帧从一个节点传输到相同链路的另一个节点。IP地址和MAC地址的这种映射关系通过ARP协议完成。
> 计算机在和其他计算机进行通信之前，需要判断目标IP地址和自身IP地址是否在同一网段，这个决定了数据链路层的目标MAC地址是目标计算机还是路由器。数据包的目标IP地址决定了数据包最终到达哪一个计算机，而目标MAC地址决定了该数据包下一跳由哪个设备接收，不一定是终点。

## 二、IP地址分类
### 1.IP地址分类详解
①、A类地址
1.A类地址第1字节为网络地址（最高位固定是0），另外3个字节为主机地址。
2.A类地址范围：1.0.0.0 - 126.255.255.255，其中0和127作为特殊地址。
3.A类网络默认子网掩码为255.0.0.0，也可写作/8。
4.A类网络最大主机数量是256×256×256-2=166777214（减去1个主机位为0的网络地址和1个广播地址）。
> 在计算机网络中，主机ID全部为0的地址为网络地址，而主机ID全部为1的地址为广播地址，这2个地址是不能分配给主机用的。

②、B类地址
1.B类地址第1字节（最高位固定是10）和第2字节为网络地址，另外2个字节为主机地址。
2.B类地址范围：128.0.0.0 - 191.255.255.255。
3.B类网络默认子网掩码为255.255.0.0，也可写作/16。
4.B类网络最大主机数量256×256-2=6554。

③、C类地址
1.C类地址第1字节（最高位固定是110）、第2字节和第3个字节，另外1个字节为主机地址。
2.C类地址范围：192.0.0.0 - 223.255.255.255。
3.C类网络默认子网掩码为255.255.255.0，也可写作/24。
4.C类网络最大主机数量256-2=254。

④、D类地址
1.D类地址不分网络地址和主机地址，它的第1个字节的最高位固定是1110。
2.D类地址用于组播（也称为多播）的地址，无子网掩码。
3.D类地址范围：224.0.0.0 - 239.255.255.255。

⑤、E类地址
1.E类地址也不分网络地址和主机地址，它的第1个字节的最高位固定是11110。
2.E类地址范围：240.0.0.0 - 255.255.255.255。
3.其中240.0.0.0-255.255.255.254作为保留地址，主要用于Internet试验和开发，255.255.255.255作为广播地址。

### 2.IP地址分类思维导图
![](/img/IP地址和子网划分学习笔记/IP地址分类.png 'IP地址分类')

## 三、公网和私网IP地址
### 1.公网IP地址
公有地址分配和管理由Inter NIC（Internet Network Information Center 因特网信息中心）负责。各级ISP使用的公网地址都需要向Inter NIC提出申请，有Inter NIC统一发放，这样就能确保地址块不冲突。
### 2.私网IP地址
创建IP寻址方案的人也创建了私网IP地址。这些地址可以被用于私有网络，在Internet没有这些IP地址，Internet上的路由器也没有到私有网络的路由表。
* A类：10.0.0.0 255.0.0.0，保留了1个A类网络。
* B类：172.16.0.0 255.255.0.0～172.31.0.0 255.255.0.0，保留了16个B类网络。
* C类：192.168.0.0 255.255.255.0～192.168.255.0 255.255.255.0，保留了256个C类网络。

### 3.公网和私网IP思维导图
![](/img/IP地址和子网划分学习笔记/公网和私网IP.png '公网和私网IP')

## 四、子网掩码
> IP地址是以网络号和主机号来标定网络上的主机的，网络号相同的主机称之为本地网络主机，网络号不同的主机称之为远程网络主机，本地网络的主机可以相互通信，远程网络的主机则需要通过本地网关来传递转发信号。

### 1.子网掩码的概念和作用
①、子网掩码又称网络掩码，必须和IP地址结合一起使用。通过子网掩码，和IP地址做“与”运算，分离出网络地址和主机地址，用以判断该IP地址是在本地网络上还是远程网络上。
②、子网掩码还进一步将网络分成若干个子网，避免主机过多而拥堵或主机过少而IP浪费。

### 2.子网掩码组成
①、点分十进制表示法
二进制转换十进制，每8位用点号隔开。例如：255.255.255.0
②、CIDR斜线记法
IP地址/n
例如：255.255.255.0，转换为二进制为11111111.11111111.11111111.00000000，可以表示为IP地址/24。
> 可以通过n来确定子网中最大主机数量=2^(32-n)-2，减2的原因是因为，主机位全为0表示该子网的网络地址，主机位全为1的表示该子网的网络地址。

### 3.子网掩码使用
> 简单地概括，A主机要和B主机通信，A和B各自的IP地址与A主机的子网掩码进行“与”运算，看得出的结果：
1.结果相同，则说明这两个主机是处于同一个网段，这样A可以通过ARP广播发现B的MAC地址，B也可以发现A的MAC地址，来实现正常通信。
2.结果不相同，A所在网络的网关会把自己的MAC地址来回应ARP广播请求，然后A所在网络的网关根据B的IP来查询路由表，再将数据包传送到B所在的网络，B所在网络的网关通过ARP广播获取B的MAC的地址，来实现正常通信。

> 计算机的网关就是到其他网段的出口，也就是路由器接口的IP地址。路由器接口使用的IP地址可以是本网段中任何一个地址，不过通常使用该网段的第一个可用的地址或最后一个可用的地址，这是为了尽可能避免和本网段中的主机地址冲突。

如下拓扑图，A和B，C和D都能两两通行，因为他们都属于同一个网段。但是A和C不属于同一个网段，所以他们通信需要经过本地网关，然后由路由器根据对方的IP地址，在路由表中正好查到有匹配到对方IP的直连路由，所以从另一边网关接口转发出去实现互连。
![](/img/IP地址和子网划分学习笔记/子网掩码拓扑图.png '子网掩码拓扑图')


## 五、子网划分
### 1.子网划分必要性
IPv4地址如果只根据ABC类来区分的话，会造成浪费或者不够用，为了解决这个问题，可以在有类网络的基础上，把一部分主机号划入网络号，这样就可以划分成各种类型大小的网络了。
### 2.子网划分和聚合
为了提高子网划分的灵活性，有两种方法，VLSM(可变长子网掩码)和CIDR(无类别域间路由)。一般意义上说的子网划分就是VLSM可变长子网掩码的划分。VLSM用于IPv4子网的划分，就是把一个大的网络划分成多个小的子网。而CIDR则用于IPv4子网的聚合，通过CIDR可以将多个小的子网路由条目汇总成一个大网络的路由条目，以减少路由器中路由条目的数量，提高路由器效率。
### 3.子网划分的方法
通过VLSM实现子网划分的基本思想很简单：就是借用现有网段的主机位的最左边某几位作为子网位，划分出多个子网。
①、把原来有类网络IPv4地址中的“网络ID”部分向“主机ID”部分借位。
②、把一部分原来属于“主机ID”部分的位变成“网络ID”的一部分（通常称之为“子网ID”）。
③、原来的“网络ID”+“子网ID”=新“网络ID”。“子网ID”的长度决定了可以划分子网的数量。
如下所示：
![](/img/IP地址和子网划分学习笔记/子网划分.png '子网划分')
子网划分的任务包括：
①、确定子网掩码的长度。
②、确定子网下的主机可用地址范围（第一个可用IP和最后一个可用IP）。
③、确定网络地址（主机位全为0）和广播地址（主机位全为1），不能分配计算机主机用。

### 4.等长子网划分
等长子网划分就是将一个有类网络等分成多个网络，每个子网的子网掩码都相同。
举一个C类网络子网划分的例子：
#### ①、等分成2个子网
将192.168.0.0 255.255.255.0这个C类网络等分成两个子网，考虑到这个IP地址的子网掩码是/24，要划分成两个子网的话，需要从主机位借用1位作为子网位。因为根据二进制，只有0和1这两种情况，原子网掩码也要相应改成/25。
如下图所示：
![](/img/IP地址和子网划分学习笔记/等分为2个子网.png '等分为2个子网')
最终结果：
A子网的网络地址：192.168.0.0/25，可用地址（192.168.0.1～192.168.0.126），广播地址：192.168.0.127。
B子网的网络地址：192.168.0.128/25，可用地址（192.168.0.129～192.168.0.254），广播地址：192.168.0.255。
即所得子网为原来的二分之一，则主机位向右移动1位，即2^1。
#### ②、等分成4个子网
即所得子网为原来的四分之一，则主机位向右移动2位，即2^2。
最终结果：
A子网的网络地址：192.168.0.0/26，可用地址（192.168.0.1～192.168.0.62），广播地址：192.168.0.63。
B子网的网络地址：192.168.0.64/26，可用地址（192.168.65～192.168.0.126），广播地址：192.168.0.127。
C子网的网络地址：192.168.0.128/26，可用地址（192.168.129～192.168.0.190），广播地址：192.168.0.191。
D子网的网络地址：192.168.0.192/26，可用地址（192.168.193/26～192.168.0.254），广播地址：192.168.0.255。
#### ③、等分成8个子网
即所得子网为原来的八分之一，则主机位向右移动3位，即2^3。
A子网的网络地址：192.168.0.0/27，可用地址（192.168.0.1～192.168.0.30），广播地址：192.168.0.31。
B子网的网络地址：192.168.0.32/27，可用地址（192.168.33～192.168.0.62），广播地址：192.168.0.63。
C子网的网络地址：192.168.0.64/27，可用地址（192.168.65～192.168.0.94），广播地址：192.168.0.95。
D子网的网络地址：192.168.0.96/27，可用地址（192.168.97～192.168.0.126），广播地址：192.168.0.127。
E子网的网络地址：192.168.0.128/27，可用地址（192.168.129～192.168.0.158），广播地址：192.168.0.159。
F子网的网络地址：192.168.0.160/27，可用地址（192.168.161～192.168.0.190），广播地址：192.168.0.191。
G子网的网络地址：192.168.0.192/27，可用地址（192.168.193～192.168.0.222），广播地址：192.168.0.223。
H子网的网络地址：192.168.0.224/27，可用地址（192.168.225～192.168.0.254），广播地址：192.168.0.255。

### 5.变长子网划分
VLSM规定了如何在一个进行了子网划分的网络中，不同子网使用不同的子网掩码。这对于网络内部不同网段需要不同大小子网的情形来说很有效，这种划分子网的方式叫变长子网划分。
变长子网划分其实就是在等长子网的划分上，分别取不同等分子网中的某个或者多个子网。
如下图所示
![](/img/IP地址和子网划分学习笔记/变长子网划分.png '变长子网划分')
A子网
网络地址：192.168.10.32，255.255.255.224（/27），可用地址（192.168.10.33 ~ 192.168.10.62），广播地址：192.168.10.63
相当于取了等长子网划分为8个子网中的一个子网。
B子网
网络地址：192.168.10.64，255.255.255.192（/26），可用地址（192.168.10.65 ~ 192.168.10.126），广播地址：192.168.10.127
相当于取了等长子网划分为4个子网中的一个子网。
C子网
网络地址：192.168.10.128，255.255.255.128（/25），可用地址（192.168.10.129 ~ 192.168.10.254），广播地址：192.168.10.255
相当于取了等长子网划分为2个子网中的一个子网。
D子网
网络地址：192.168.10.0，255.255.255.252（/30），可用地址（192.168.10.1 ~ 192.168.10.2），广播地址：192.168.10.3
相当于取了等长子网划分为64个子网中的第一个子网。
E子网
网络地址：192.168.10.4，255.255.255.252（/30），可用地址（192.168.10.5 ~ 192.168.10.6），广播地址：192.168.10.7
相当于取了等长子网划分为64个子网中的第二个子网。

## 六、超网合并
超网是与子网类似的概念，是集合多个同类互联网地址的一种方法。与子网划分相反，它是把一些小网络组合成一个大网络。
如下图所示
![](/img/IP地址和子网划分学习笔记/超网合并.png '超网合并')