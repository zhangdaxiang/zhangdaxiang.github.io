---
title: git学习(2):git版本库管理
date: 2017-11-01 11:06:49
tags: git
categories: git
---

之前我们已经成功提交了一个`readme.txt`文件,接下来，可以对这个文件进行修改，然后运行`git status`命令可以看到结果，这个命令可以让我们随时掌握仓库的状态，如果我们要看看具体改了哪些内容，可以使用`git diff`这个命令来查看。然后如果要将修改的文件进行提交的话，操作就和之前的一样了。
### 版本控制
#### 版本回退
git的版本回退就类似于快照，每次我们`commit`之后，就在版本库给我们建立一个快照。如果我们把文件误删了，或者搞混了，就可以从最近的一`commit`恢复。
我们使用`git log`这个命令可以查看我们的历史记录，如果觉得输出太多，可以加上`--pretty=oneline`参数来提取`commit id`。这里需要注意的是，git的版本号和svn不一样，并不是1,2,3....这样递增的数字，而是一个通过SHA1计算得到的非常大的数字，并且用十六进制表示，这样可以从很大程度上避免版本号的冲突。
现在，我们要开始进行版本回退，git必须知道当前版本，用`HEAD`表示当前版本，上一个版本就是`HEAD^`，再上一个版本就是`HEAD^^`，如果往上100个版本就写做`HEAD~100`。
所以我们要回退到上一个版本的命令就是：
```bash
git resrt --hard HEAD^
```
如果我们知道`commit id`的话，我也可以直接使用`commit id`，比如id是`123456....`，就是：
```bash
git reset --hard 123456
```
版本号没必要写全，写前面几位就可以了。
如果我们忘记了摸个版本的`commit id`，我们可以使用`git reflog`来查看之前的历史命令，这样也可以查看到之前的`commit id`。
git和svn相比，多了一个暂存区的概念。
#### 工作区
工作区的通俗来理解，应该就是我们的工作目录，也就是文件的目录。
#### 版本库
在工作区里有一个名为`.git`的隐藏目录，这个就是git的版本库。其中比较重要的就是被称为stage的暂存区，以及创建工作区是自动生成的`master`分支，以及指向`master`的名为`HEAD`的指针。
之前我们提交的两步操作:
第一步，`git add`就是将文件修改添加到暂存区。
第二步，`git commit`就是 将文件修改**一次性**从暂存区提交到分支。
#### 管理修改
接下来我们需要了解到的是，git跟踪的是修改，而不是文件。
举个栗子，我们修改了一个名为`readme.txt`的文件，先用`git add readme.txt`添加到暂存区，然后再次修改这个文件，最后用`git commit`提交到分支。这个时候我们用`git status`查看状态，可以发现，第二次修改并没有被提交。
这是因为，第一次修改之后，我们使用了`git add`将修改添加到了暂存区，第二次修改却没有这样操作，所以`git commit`并不会将第二次修改提交到分支。如果我们想把第二次修改也提交到分支的话，可以在第二次修改之后，再次使用`git add readme.txt`，这样就可以一起提交了。
如果我们想查看工作区和版本库之间的差别的话，可以使用：
```bash
git diff HEAD -- readme.txt
```
#### 撤销修改
如果发现工作区的文件在我们修改之后有错误，想把他恢复到上一个版本的状态。可以使用`git checkout -- readme.txt`来丢弃工作区的修改。
这里分成两种情况:
第一种，`readme.txt`修改之后没有提交到暂存区，这时候撤销修改就恢复到版本库里的状态。
第二种，`readme.txt`修改之后提交到了暂存区，撤销修改就恢复到提交到暂存区时的状态。
如果我们的修改在提交到暂存区之后才发现错误，这个时候要修改的话。我们需要先使用`git reset HEAD readme.txt`把暂存区的修改撤销掉，重新放回工作区。然后按之前修改工作区的文件的步骤进行。
#### 删除文件
当我们在工作区删除了一个文件之后，希望在版本库中也删除这个文件。我们先用`git status`查看状态，git会非常人性化地提示我们，版本库和工作区不一致，并且告诉我们哪个文件不一致。而且，他会给我们两个选择：
一个是要从版本库里面也删除这个文件，我们可以使用`git rm readme.txt`来删除，然后用`git commit`提交。这样，版本库里的文件也被删除了。
另一个是删错了，我们想要恢复工作区的文件，我们可以使用`git checkout -- readme.txt`来将误删的文件恢复到最新版本。

### 远程仓库
说到远程仓库，首选当然是代码圈大型交友平台github啦，嘿嘿。
#### 添加SSH
我们想要把本地版本库和github上面的仓库关联起来，是通过SSH协议的。只需要两步就可以实现这个：
第一步，在主目录下查看是否拥有`.ssh`文件夹，如果有，再看看是否有`id_rsa`和`id_rsa.pub`，其中`id_rsa`是私钥，`id_rsa.pub`是公钥。有的话就可以进行第二步了，没有的话，就打开shell窗口，执行以下代码：
```bash
ssh -keygen -t rsa -C "youemail@address.com"
```
在`.ssh`里生成上面的公钥和私钥。
第二步，在github里打开Account settings，SSH Keys页面，然后，点Add SSH Key，填上任意Title，在Key文本框里粘贴id_rsa.pub文件的内容。
#### 添加远程库
先在github上建立一个`repository`,然后在本地工作区打开shell，运行命令：
```bash
git remote add origin git@github.com:用户名/仓库名.git
```
添加以后，远程仓库就叫`origin`,这个是git的默认叫法，也可以改成别的。
接下来，可以使用`git push`来讲本地版本库推送到远程仓库。第一次推送的时候，加上`-u`参数，git会把本地`master`分支推送到远程`master`分支，还会将两者关联起来。如下：
```bash
git push -u origin master
```
这样，github上也有了和本地一模一样的内容了。
以后在本地修改，只要通过命令：
```bash
git push origin master
```
就可以把本地最新的`master`分支推送到github了。
#### 从远程仓库克隆
在一个空的文件夹，执行命令:
```bash
git clone git@github.com:用户名/仓库名.git
```
将远程仓库克隆到本地。
Git支持多种协议，包括`https`，但通过`ssh`支持的原生git协议速度最快